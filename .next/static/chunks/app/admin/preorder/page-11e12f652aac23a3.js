(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7816],{3526:(e,s,t)=>{Promise.resolve().then(t.bind(t,7855))},7855:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var r=t(5155),d=t(2115);let i=["settings","products","orders"];function a(e){let{value:s,current:t,onClick:d,children:i}=e,a=t===s;return(0,r.jsx)("button",{onClick:()=>d(s),className:"rounded-md px-3 py-1 text-sm transition "+(a?"bg-black text-white dark:bg-white dark:text-black":"hover:bg-black/5 dark:hover:bg-white/5"),children:i})}function n(e){let{kind:s="neutral",children:t}=e,d={success:"bg-green-500/15 text-green-500",warn:"bg-yellow-500/15 text-yellow-400",neutral:"bg-white/10 text-white/80"};return(0,r.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold "+(d[s]||d.neutral),children:t})}function l(e){let{value:s}=e,t=Number(s||0);return(0,r.jsx)("span",{children:t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})})}function c(e){let{addr:s,customer:t}=e;if(!s&&!t)return(0,r.jsx)("span",{children:"—"});if(s&&"string"==typeof s)return(0,r.jsx)("span",{children:s});let d=s||{},i=[d.address||(null==t?void 0:t.address),d.area,d.city,d.postcode].filter(Boolean).join(", ");return(0,r.jsx)("span",{children:i||"—"})}function o(e){let{orders:s,onVerify:t,verifyingId:d,expanded:i,setExpanded:a,updateOrder:o}=e;return(null==s?void 0:s.length)?(0,r.jsx)("div",{className:"overflow-x-auto rounded-2xl border border-white/10",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-white/5",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Created"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Customer"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"Advance Due"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"Advance Paid"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Status"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Order Status"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Invoice ID"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:s.map(e=>{var s,x,h,p,m,u,j,b,y;return[(0,r.jsxs)("tr",{className:"border-t border-white/10",children:[(0,r.jsx)("td",{className:"px-4 py-3",children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3",children:(null==e||null==(s=e.customer)?void 0:s.name)||(null==e||null==(x=e.customer)?void 0:x.phone)||(null==e||null==(h=e.customer)?void 0:h.email)||"—"}),(0,r.jsx)("td",{className:"px-4 py-3 text-right",children:(0,r.jsx)(l,{value:e.advanceDue})}),(0,r.jsx)("td",{className:"px-4 py-3 text-right",children:(0,r.jsx)(l,{value:e.advancePaid})}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[e.paid?(0,r.jsx)(n,{kind:"success",children:"Paid"}):(0,r.jsx)(n,{kind:"warn",children:"Not paid"}),(0,r.jsxs)("span",{className:"ml-2 opacity-70 text-xs",children:["(",e.uddoktaStatus||(e.paid?"PAID":"PENDING"),")"]}),(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs",children:[(0,r.jsxs)("label",{className:"flex items-center gap-1",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!e.preOrderAdvancePaid,onChange:s=>o(e,{preOrderAdvancePaid:s.target.checked})})," Advance paid"]}),(0,r.jsxs)("label",{className:"flex items-center gap-1",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!e.preOrderBalancePaid,onChange:s=>o(e,{preOrderBalancePaid:s.target.checked})})," Balance paid"]})]})]}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("select",{value:e.currentStatus||"Pending",onChange:s=>o(e,{currentStatus:s.target.value}),className:"rounded-lg border px-2 py-1 text-xs bg-transparent",children:[(0,r.jsx)("option",{value:"Pending",children:"Pending"}),(0,r.jsx)("option",{value:"Processing",children:"Processing"}),(0,r.jsx)("option",{value:"Shipped",children:"Shipped"}),(0,r.jsx)("option",{value:"Delivered",children:"Delivered"}),(0,r.jsx)("option",{value:"Cancelled",children:"Cancelled"})]})}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-xs",children:e.invoiceId||"—"}),(0,r.jsxs)("td",{className:"px-4 py-3 text-right flex gap-2 justify-end",children:[e.invoiceId?(0,r.jsx)("button",{onClick:()=>navigator.clipboard.writeText(e.invoiceId),className:"px-2 py-1 rounded-md border border-white/15 hover:bg-white/5 text-xs",children:"Copy ID"}):null,(0,r.jsx)("button",{onClick:()=>a(s=>({...s,[e.id]:!s[e.id]})),className:"px-2 py-1 rounded-md border border-white/15 hover:bg-white/5 text-xs",children:i[e.id]?"Hide":"Details"}),e.invoiceId?(0,r.jsx)("button",{onClick:()=>t(e.id),disabled:d===e.id,className:"px-2 py-1 rounded-md border border-white/15 hover:bg-white/5 text-xs disabled:opacity-60",children:d===e.id?"Verifying…":"Verify"}):null]})]},e.id),i[e.id]?(0,r.jsx)("tr",{className:"border-t border-white/10",children:(0,r.jsx)("td",{colSpan:7,className:"px-4 py-3 bg-white/5",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-xs",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"Customer"}),(0,r.jsxs)("div",{children:["Name: ",(null==(p=e.customer)?void 0:p.name)||"—"]}),(0,r.jsxs)("div",{children:["Phone: ",(null==(m=e.customer)?void 0:m.phone)||"—"]}),(0,r.jsxs)("div",{children:["Email: ",(null==(u=e.customer)?void 0:u.email)||"—"]}),(0,r.jsxs)("div",{children:["Address:"," ",(0,r.jsx)(c,{addr:e.address,customer:e.customer})]}),(0,r.jsxs)("div",{children:["City: ",(null==(j=e.address)?void 0:j.city)||(null==(b=e.customer)?void 0:b.city)||"—"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold mb-1",children:"Payment"}),(0,r.jsxs)("div",{children:["Order ID: ",(0,r.jsx)("span",{className:"font-mono",children:e.id})]}),(0,r.jsxs)("div",{children:["Status: ",e.uddoktaStatus||(e.paid?"PAID":"PENDING")]}),(0,r.jsxs)("div",{children:["Provider: ",e.provider||"—"]}),(0,r.jsxs)("div",{children:["Method: ",e.paymentMethod||"—"]}),(0,r.jsxs)("div",{children:["Txn ID: ",(0,r.jsx)("span",{className:"font-mono",children:e.transactionId||"—"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-semibold mb-1",children:["Items (",(null==(y=e.items)?void 0:y.length)||0,")"]}),(0,r.jsx)("ul",{className:"space-y-1",children:(e.items||[]).map((e,s)=>(0,r.jsxs)("li",{className:"flex justify-between gap-2",children:[(0,r.jsx)("span",{className:"truncate",children:e.name}),(0,r.jsxs)("span",{children:["x",e.qty]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"opacity-70",children:"@"})," ",Number(e.price||0).toFixed(2)]})]},s))})]})]})})},"".concat(e.id,"-details")):null]})})]})}):(0,r.jsx)("div",{className:"border border-white/10 rounded-2xl p-8 text-sm opacity-80",children:"No pre-orders found yet."})}function x(){let[e,s]=(0,d.useState)("orders"),[t,n]=(0,d.useState)([]),[l,c]=(0,d.useState)(null),[x,p]=(0,d.useState)([]),[m,u]=(0,d.useState)(!1),[j,b]=(0,d.useState)(!1),[y,v]=(0,d.useState)(!1),[g,N]=(0,d.useState)(null),[f,w]=(0,d.useState)({});async function k(){u(!0);try{let e=await fetch("/api/admin/preorder/orders",{cache:"no-store"}),s=await e.json();(null==s?void 0:s.ok)&&Array.isArray(s.orders)?n(s.orders):n([])}catch(e){console.error("Failed to load orders",e),n([])}finally{u(!1)}}async function P(){b(!0);try{let e=await fetch("/api/admin/preorder/settings",{cache:"no-store"}),s=await e.json();(null==s?void 0:s.ok)&&c(s.settings||s.data||s)}catch(e){console.error("settings load failed",e)}finally{b(!1)}}async function S(){v(!0);try{let e=await fetch("/api/admin/preorder/products",{cache:"no-store"}),s=await e.json();Array.isArray(null==s?void 0:s.products)?p(s.products):Array.isArray(null==s?void 0:s.data)?p(s.data):p([])}catch(e){console.error("products load failed",e),p([])}finally{v(!1)}}async function C(e){N(e);try{await fetch("/api/admin/preorder/orders/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e})}),await k()}catch(e){console.error("verify failed",e)}finally{N(null)}}async function O(e,s){let t=e._id||e.id;if(!t)return;let r=await fetch("/api/admin/preorder/orders/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),d=await r.json();(null==d?void 0:d.ok)&&n(e=>e.map(e=>String(e._id||e.id)===String(t)?{...e,...s}:e))}return(0,d.useEffect)(()=>{k(),P(),S()},[]),(0,r.jsxs)("main",{className:"container mx-auto max-w-6xl px-4 py-8",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"Preorder Admin"}),(0,r.jsx)("div",{className:"mt-6 flex gap-2",children:i.map(t=>(0,r.jsx)(a,{value:t,current:e,onClick:s,children:t[0].toUpperCase()+t.slice(1)},t))}),(0,r.jsxs)("div",{className:"mt-6",children:["orders"===e&&(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Orders"}),(0,r.jsx)("button",{onClick:k,className:"px-3 py-1 rounded-md border border-white/15 hover:bg-white/5",children:"Refresh"})]}),m?(0,r.jsx)("div",{className:"rounded-xl border border-white/10 p-6 text-sm opacity-80",children:"Loading orders…"}):(0,r.jsx)(o,{orders:t,onVerify:C,verifyingId:g,expanded:f,setExpanded:w,updateOrder:O})]}),"settings"===e&&(0,r.jsxs)("section",{className:"rounded-xl border border-white/10 p-6 text-sm",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Settings"}),j?(0,r.jsx)("div",{className:"opacity-80",children:"Loading settings…"}):l?(0,r.jsx)("pre",{className:"whitespace-pre-wrap break-words text-xs bg-white/5 p-3 rounded-lg border border-white/10",children:JSON.stringify(l,null,2)}):(0,r.jsx)("div",{className:"opacity-80",children:"No settings found."})]}),"products"===e&&(0,r.jsxs)("section",{className:"rounded-xl border border-white/10 p-6 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Preorder Products"}),(0,r.jsx)("button",{onClick:S,className:"px-3 py-1 rounded-md border border-white/15 hover:bg-white/5",children:"Refresh"})]}),y?(0,r.jsx)("div",{className:"opacity-80",children:"Loading products…"}):x.length?(0,r.jsx)("ul",{className:"space-y-2",children:x.map(e=>{var s;return(0,r.jsxs)("li",{className:"rounded-lg border border-white/10 p-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.name||e.title||e.slug}),(0,r.jsxs)("div",{className:"text-xs opacity-70",children:["slug: ",e.slug||"—"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("label",{className:"text-xs flex items-center gap-1",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!e.isPreOrder,onChange:s=>h(e,{isPreOrder:s.target.checked})})," Pre‑order"]}),(0,r.jsx)("input",{type:"number",min:0,max:100,className:"w-20 rounded-md border border-white/10 px-2 py-1 bg-transparent text-xs",value:null!=(s=e.preOrderAdvancePercent)?s:50,onChange:s=>h(e,{preOrderAdvancePercent:Number(s.target.value)})}),(0,r.jsx)("input",{className:"w-48 rounded-md border border-white/10 px-2 py-1 bg-transparent text-xs",placeholder:"Lead time e.g. Ships in 3–4 weeks",value:e.preOrderLeadTimeText||"",onChange:s=>h(e,{preOrderLeadTimeText:s.target.value})}),(0,r.jsx)("button",{onClick:()=>S(),className:"px-2 py-1 rounded-md border border-white/15 hover:bg-white/5 text-xs",children:"Refresh"})]})]},e._id||e.id)})}):(0,r.jsx)("div",{className:"opacity-80",children:"No preorder products yet."})]})]})]})}async function h(e,s){let t=e._id||e.id;if(!t)return;let r=await fetch("/api/admin/preorder/products/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),d=await r.json();(null==d?void 0:d.ok)&&setProducts(e=>e.map(e=>String(e._id||e.id)===String(t)?d.data:e))}}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=3526)),_N_E=e.O()}]);