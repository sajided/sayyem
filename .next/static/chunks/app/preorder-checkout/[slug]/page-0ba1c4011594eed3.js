(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6445],{1469:(e,a,r)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),!function(e,a){for(var r in a)Object.defineProperty(e,r,{enumerable:!0,get:a[r]})}(a,{default:function(){return n},getImageProps:function(){return i}});let t=r(8229),s=r(8883),d=r(3063),l=t._(r(1193));function i(e){let{props:a}=(0,s.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(a))void 0===r&&delete a[e];return{props:a}}let n=d.Image},3615:(e,a,r)=>{"use strict";r.d(a,{default:()=>n});var t=r(5155),s=r(2115),d=r(6766),l=r(6874),i=r.n(l);function n(e){var a;let{slug:r}=e,[l,n]=(0,s.useState)(!0),[c,o]=(0,s.useState)(null),[u,m]=(0,s.useState)({preOrderDefaultAdvancePercent:50,bkashEnabled:!1,uddoktaPayEnabled:!1}),[h,b]=(0,s.useState)({bkashEnabled:!1,uddoktaPayEnabled:!1}),[x,p]=(0,s.useState)(1),[f,v]=(0,s.useState)(""),[j,y]=(0,s.useState)(""),[k,g]=(0,s.useState)(""),[N,w]=(0,s.useState)(""),[P,S]=(0,s.useState)(""),[O,C]=(0,s.useState)(""),[E,A]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=!0;return async function(){try{let[a,t]=await Promise.all([fetch("/api/products/".concat(r)),fetch("/api/public/site-settings")]),s=await a.json().catch(()=>({}));if(!a.ok||!(null==s?void 0:s.product)){e&&C("Product not found");return}let d=await t.json().catch(()=>({})),l=((null==d?void 0:d.ok)?d.data:null==d?void 0:d.settings)||{};e&&(o(s.product),m(l),b({bkashEnabled:!!l.bkashEnabled,uddoktaPayEnabled:!!l.uddoktaPayEnabled}))}catch(a){e&&C(a.message||"Failed to load")}finally{e&&n(!1)}}(),()=>{e=!1}},[r]);let M=(0,s.useMemo)(()=>(function(e){if(null==e)return 0;if("number"==typeof e)return Number.isFinite(e)?e:0;if("string"==typeof e){let a=Number(e.replace(/[^0-9.]/g,""));return Number.isFinite(a)?a:0}return 0})(null==c?void 0:c.price),[c]),_=(0,s.useMemo)(()=>Math.max(0,M*x),[M,x]),F=(0,s.useMemo)(()=>_+60,[_,60]),D=(0,s.useMemo)(()=>(null==c?void 0:c.preOrderAdvancePercent)!=null?Number(c.preOrderAdvancePercent)||50:Number(null==u?void 0:u.preOrderDefaultAdvancePercent)||50,[c,u]),X=(0,s.useMemo)(()=>Math.round(F*D/100),[F,D]),T=(0,s.useMemo)(()=>Math.max(0,F-X),[F,X]);if(l)return(0,t.jsx)("div",{className:"py-12 text-center",children:"Loading…"});if(!c)return(0,t.jsx)("div",{className:"py-12 text-center",children:"Product not found"});async function q(){let e={slug:r,email:k&&k.includes("@")?k:j?"".concat(String(j).replace(/\\D/g,""),"@toyrush.local"):"customer@toyrush.local",qty:x,name:f,phone:j,address:P,city:N,delivery:(null==N?void 0:N.toLowerCase().includes("dhaka"))?"inside":"outside",subtotal:_,deliveryFee:60,total:F,preOrderAdvancePercent:D,advanceAmount:X,dueOnDelivery:T},a=await fetch("/api/preorders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json().catch(()=>({}));if(!a.ok||!(null==t?void 0:t.id))throw Error((null==t?void 0:t.error)||"Failed to create pre‑order");return t.id}async function U(e){if(e.preventDefault(),!P||!P.trim())return void C("Address is required");e.preventDefault();try{A(!0);let e=await q(),a=await fetch("/api/payments/bkash/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,full_name:f,email:k,amount:String(X),metadata:{phone:j,address:P,city:N,slug:r,qty:x}})}),t=await a.json().catch(()=>({}));if(!a.ok||!(null==t?void 0:t.bkashURL))throw Error((null==t?void 0:t.error)||"Failed to initialize bKash payment");window.location.href=t.bkashURL}catch(e){C(e.message||"Failed to place order")}finally{A(!1)}}async function z(){if(!P||!P.trim())return void C("Address is required");try{A(!0);let e=await q(),a=await fetch("/api/payments/uddoktapay/create",{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-store",body:JSON.stringify({orderId:e})}),r=await a.json().catch(()=>({}));if(!a.ok||!(null==r?void 0:r.url))throw Error((null==r?void 0:r.error)||"Failed to initialize UddoktaPay");window.location.replace(r.url)}catch(e){C((null==e?void 0:e.message)||"Failed to start payment"),A(!1)}}return(0,t.jsxs)("div",{className:"py-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Pre‑order Checkout"}),(0,t.jsxs)("form",{onSubmit:U,className:"mt-4 grid gap-6 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,t.jsx)("section",{className:"rounded-xl border border-black/10 p-4 text-sm dark:border-white/10",children:(0,t.jsxs)("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"grid gap-1 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs",children:"Full name"}),(0,t.jsx)("input",{value:f,onChange:e=>v(e.target.value),required:!0,className:"rounded-xl border border-black/10 px-3 py-2 dark:border-white/10 dark:bg-black/60"})]}),(0,t.jsxs)("div",{className:"grid gap-1",children:[(0,t.jsx)("label",{className:"text-xs",children:"Email"}),(0,t.jsx)("input",{type:"email",value:k,onChange:e=>g(e.target.value),required:!0,placeholder:"you@example.com",className:"rounded-xl border border-black/10 px-3 py-2 dark:border-white/10 dark:bg-black/60"})]}),(0,t.jsxs)("div",{className:"grid gap-1",children:[(0,t.jsx)("label",{className:"text-xs",children:"Phone"}),(0,t.jsx)("input",{value:j,onChange:e=>y(e.target.value),required:!0,placeholder:"01XXXXXXXXX",className:"rounded-xl border border-black/10 px-3 py-2 dark:border-white/10 dark:bg-black/60"})]}),(0,t.jsxs)("div",{className:"grid gap-1",children:[(0,t.jsx)("label",{className:"text-xs",children:"City"}),(0,t.jsx)("input",{value:N,onChange:e=>w(e.target.value),className:"rounded-xl border border-black/10 px-3 py-2 dark:border-white/10 dark:bg-black/60"})]}),(0,t.jsxs)("div",{className:"grid gap-1 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs",children:"Address"}),(0,t.jsx)("textarea",{value:P,onChange:e=>S(e.target.value),rows:2,className:"rounded-xl border border-black/10 px-3 py-2 dark:border-white/10 dark:bg-black/60",required:!0})]})]})}),(0,t.jsxs)("section",{className:"rounded-xl border border-black/10 p-4 text-sm dark:border-white/10",children:[(0,t.jsx)("p",{className:"font-medium",children:"Payment"}),(0,t.jsxs)("label",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsx)("input",{type:"radio",checked:!0,readOnly:!0}),(0,t.jsxs)("span",{children:["UddoktaPay (advance ",D,"%)"]})]}),(0,t.jsxs)("label",{className:"mt-1 flex items-center gap-2 opacity-60",children:[(0,t.jsx)("input",{type:"radio",disabled:!0}),(0,t.jsx)("span",{children:"Cash on delivery (disabled for pre‑orders)"})]})]}),O&&(0,t.jsx)("div",{className:"rounded-xl border border-black/10 p-3 text-sm text-red-600 dark:border-white/10 dark:text-red-400",children:O})]}),(0,t.jsx)("aside",{className:"space-y-4",children:(0,t.jsxs)("section",{className:"rounded-xl border border-black/10 p-4 text-sm dark:border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"relative h-16 w-16 overflow-hidden rounded-lg border border-black/10 dark:border-white/10",children:(null==(a=c.images)?void 0:a[0])&&(0,t.jsx)(d.default,{src:c.images[0],alt:c.name,fill:!0,className:"object-cover"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:c.name}),(0,t.jsxs)("div",{className:"text-xs opacity-80",children:["Unit price: ৳",M]}),(0,t.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs",children:"Qty"}),(0,t.jsx)("input",{type:"number",min:1,value:x,onChange:e=>p(Math.max(1,Number(e.target.value)||1)),className:"w-20 rounded-xl border border-black/10 px-3 py-1 text-sm dark:border-white/10 dark:bg-black/60"})]})]})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Subtotal"}),(0,t.jsxs)("span",{children:["৳",_]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Delivery fee"}),(0,t.jsxs)("span",{children:["৳",60]})]}),(0,t.jsx)("div",{className:"h-px bg-black/10 dark:bg-white/10 my-2"}),(0,t.jsxs)("div",{className:"flex items-center justify-between font-medium",children:[(0,t.jsx)("span",{children:"Total amount"}),(0,t.jsxs)("span",{children:["৳",F]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["Payable now (",D,"%)"]}),(0,t.jsxs)("span",{className:"font-semibold",children:["৳",X]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Due as COD"}),(0,t.jsxs)("span",{children:["৳",T]})]})]}),(0,t.jsx)("button",{type:"button",onClick:z,className:"mt-3 w-full rounded-xl border border-black/10 bg-black px-4 py-2 font-medium text-white hover:opacity-90 disabled:opacity-50 dark:border-white/10 dark:bg-white dark:text-black",children:"Pay Advance with Uddokta Pay"}),(0,t.jsx)(i(),{href:"/product/".concat(c.slug),className:"mt-2 block text-center text-sm opacity-80 hover:opacity-100",children:"Back"})]})})]})]})}},6766:(e,a,r)=>{"use strict";r.d(a,{default:()=>s.a});var t=r(1469),s=r.n(t)},7947:(e,a,r)=>{Promise.resolve().then(r.bind(r,3615))}},e=>{e.O(0,[6874,3063,8441,5964,7358],()=>e(e.s=7947)),_N_E=e.O()}]);