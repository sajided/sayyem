(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8279],{7352:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),s=a(2115);function d(e){return(0,r.jsxs)("svg",{viewBox:"0 0 160 96",width:"24",height:"16","aria-hidden":"true",...e,children:[(0,r.jsx)("rect",{width:"160",height:"96",fill:"#006A4E"}),(0,r.jsx)("circle",{cx:"70",cy:"48",r:"28",fill:"#F42A41"})]})}function l(){let[e,t]=(0,s.useState)(!1),[a,l]=(0,s.useState)(""),[n,i]=(0,s.useState)(!1),[c,o]=(0,s.useState)([]),[m,x]=(0,s.useState)(""),[h,b]=(0,s.useState)(null),[u,p]=(0,s.useState)(""),[j,k]=(0,s.useState)(!1),[g,f]=(0,s.useState)("inside"),[w,N]=(0,s.useState)("cod"),[y,v]=(0,s.useState)(""),[S,C]=(0,s.useState)(!1),[D,O]=(0,s.useState)("");(0,s.useEffect)(()=>{try{let e=localStorage.getItem("tr:cart")||"[]";o(JSON.parse(e))}catch(e){}},[]);let X=(0,s.useMemo)(()=>c.reduce((e,t)=>e+t.price*t.qty,0),[c]),T="inside"===g?60:100,I=h?"percent"===h.type?Math.floor(X*(h.amount/100)):Math.min(X,h.amount):0,P=Math.max(0,X-I)+(c.length?T:0)+50*!!n;async function q(e){e.preventDefault();let a=new FormData(e.currentTarget);t(!0),l("");let r=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.get("name"),phone:(()=>{let e=(a.get("phone")||"").toString().trim();return e.startsWith("+88")?e:"+88".concat(e)})(),address:a.get("address"),city:a.get("city")||"Dhaka",note:a.get("note")||"",items:c,coupon:h,delivery:g,payment:w,giftWrap:n,giftWrapFee:50*!!n})}),s=await r.json();t(!1),r.ok?(localStorage.removeItem("tr:cart"),o([]),O("✅ Order placed successfully!\nOrder ID: ".concat(s.id)),C(!0),setTimeout(()=>{window.location.href="/"},3e3)):l(s.error||"Failed to place order")}return(0,r.jsxs)("div",{className:"py-8 grid gap-8 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Checkout"}),(0,r.jsxs)("form",{onSubmit:q,className:"mt-4 grid max-w-xl gap-3",children:[(0,r.jsx)("input",{name:"name",required:!0,placeholder:"Full name",className:"rounded-xl border border-black/10 bg-white/70 px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60"}),(0,r.jsxs)("div",{className:"flex rounded-xl border border-black/10 bg-white dark:border-white/10 dark:bg-black/60 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-r border-black/10 dark:border-white/10",children:[(0,r.jsx)("span",{className:"text-xl",children:(0,r.jsx)(d,{className:"h-4 w-6 rounded-sm"})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"+88"})]}),(0,r.jsx)("input",{name:"phone",required:!0,inputMode:"numeric",pattern:"\\d*",maxLength:11,placeholder:"01XXXXXXXXX",className:"w-full bg-transparent px-3 py-2 text-sm outline-none",onInput:e=>{e.currentTarget.value=e.currentTarget.value.replace(/[^0-9]/g,"")}})]}),(0,r.jsx)("input",{name:"address",required:!0,placeholder:"Delivery address",className:"rounded-xl border border-black/10 bg-white/70 px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60"}),(0,r.jsx)("input",{name:"city",placeholder:"City (Dhaka)",className:"rounded-xl border border-black/10 bg-white/70 px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60"}),(0,r.jsx)("textarea",{name:"note",placeholder:"Special note (optional) — e.g., 'Please call before delivery'",className:"mt-2 h-24 w-full resize-y rounded-xl border border-black/10 bg-white/70 px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60",onChange:e=>v(e.target.value)}),(0,r.jsxs)("div",{className:"mt-2 rounded-xl border border-black/10 p-3 text-sm dark:border-white/10",children:[(0,r.jsx)("p",{className:"font-medium",children:"Delivery"}),(0,r.jsxs)("label",{className:"mt-2 flex items-center gap-2",children:[(0,r.jsx)("input",{type:"radio",name:"delivery",value:"inside",checked:"inside"===g,onChange:()=>f("inside")})," Inside Dhaka (৳60)"]}),(0,r.jsxs)("label",{className:"mt-1 flex items-center gap-2",children:[(0,r.jsx)("input",{type:"radio",name:"delivery",value:"outside",checked:"outside"===g,onChange:()=>f("outside")})," Outside Dhaka (৳100)"]})]}),(0,r.jsxs)("div",{className:"mt-2 rounded-xl border border-black/10 p-3 text-sm dark:border-white/10",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:n,onChange:e=>i(e.target.checked)}),(0,r.jsx)("span",{children:"Want gift wrap — ৳50"})]}),(0,r.jsx)("p",{className:"mt-1 text-xs text-neutral-500",children:"We’ll wrap your order as a gift."})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-black/10 p-3 text-sm dark:border-white/10",children:[(0,r.jsx)("p",{className:"font-medium",children:"Payment"}),(0,r.jsxs)("label",{className:"mt-2 flex items-center gap-2",children:[(0,r.jsx)("input",{type:"radio",name:"payment",value:"cod",checked:"cod"===w,onChange:()=>N("cod")})," Cash on delivery"]})]}),(0,r.jsx)("button",{disabled:e||0===c.length,className:"mt-2 rounded-xl border border-black/10 bg-black px-4 py-2 text-sm font-medium text-white disabled:opacity-50 dark:border-white/10 dark:bg-white dark:text-black",children:e?"Placing…":"Place order"}),a&&(0,r.jsx)("p",{className:"text-sm",children:a})]})]}),(0,r.jsxs)("aside",{className:"rounded-2xl border border-black/10 p-4 dark:border-white/10",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Order summary"}),(0,r.jsxs)("div",{className:"mt-3 space-y-3",children:[0===c.length&&(0,r.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Your cart is empty."}),c.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("img",{src:e.image,alt:"",className:"h-10 w-10 rounded object-cover"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:["Qty ",e.qty]})]})]}),(0,r.jsxs)("span",{children:["৳",e.price*e.qty]})]},e.slug))]}),(0,r.jsxs)("div",{className:"mt-4 rounded-xl border border-black/10 p-3 text-sm dark:border-white/10",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>k(e=>!e),className:"flex w-full items-center justify-between rounded-xl border border-black/10 bg-white px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60","aria-expanded":j,"aria-controls":"coupon-panel",children:[(0,r.jsx)("span",{className:"font-medium",children:"Have a coupon?"}),(0,r.jsx)("span",{className:"transition-transform ".concat(j?"rotate-180":""),children:"⌄"})]}),(0,r.jsxs)("div",{id:"coupon-panel",className:"mt-2 overflow-hidden transition-all duration-300 ".concat(j?"max-h-40 opacity-100":"max-h-0 opacity-0"),children:[(0,r.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,r.jsx)("input",{value:m,onChange:e=>x(e.target.value),placeholder:"Enter code",className:"flex-1 rounded-xl border border-black/10 bg-white/70 px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60"}),(0,r.jsx)("button",{onClick:async()=>{p(""),b(null);let e=await fetch("/api/coupons/validate?code=".concat(encodeURIComponent(m))),t=await e.json();if(!e.ok||!t.valid)return void p(t.reason||"Invalid code");b({type:t.type,amount:t.amount,code:t.code})},className:"rounded-xl border border-black/10 bg-white px-3 py-2 text-sm dark:border-white/10 dark:bg-black/60",children:"Apply"})]}),u&&(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:u}),h&&(0,r.jsxs)("p",{className:"mt-1 text-xs",children:["Applied: ",(0,r.jsx)("span",{className:"font-medium",children:h.code})," (","percent"===h.type?"".concat(h.amount,"% off"):"৳".concat(h.amount," off"),")"]})]})]}),(0,r.jsxs)("div",{className:"mt-4 space-y-1 border-t border-black/10 pt-3 text-sm dark:border-white/10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Subtotal"}),(0,r.jsxs)("span",{className:"font-medium",children:["৳",X]})]}),I>0&&(0,r.jsxs)("div",{className:"flex items-center justify-between text-red-600",children:[(0,r.jsx)("span",{children:"Discount"}),(0,r.jsxs)("span",{className:"font-medium",children:["-৳",I]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Delivery"}),(0,r.jsxs)("span",{className:"font-medium",children:["৳",c.length?T:0]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between border-t border-black/10 pt-2 dark:border-white/10",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{className:"text-base font-semibold",children:["৳",P]})]})]})]}),S&&(0,r.jsxs)("div",{id:"order-modal",className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>C(!1),"aria-hidden":"true"}),(0,r.jsxs)("div",{role:"dialog","aria-modal":"true",className:"relative w-[92%] max-w-sm rounded-2xl border border-black/10 bg-white p-5 text-center shadow-2xl dark:border-white/10 dark:bg-neutral-900",children:[(0,r.jsx)("div",{className:"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full border border-green-600/30 bg-green-600/10",children:(0,r.jsx)("span",{className:"text-2xl",children:"✅"})}),(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Order Placed"}),(0,r.jsx)("p",{className:"mt-1 whitespace-pre-line text-sm text-neutral-700 dark:text-neutral-300",children:D||"Thank you for shopping with us."}),(0,r.jsx)("p",{className:"mt-3 text-xs text-neutral-500",children:"You will be redirected to the homepage shortly…"}),(0,r.jsx)("button",{className:"mt-4 w-full rounded-xl border border-black/10 bg-black px-3 py-2 text-sm font-medium text-white hover:opacity-90 dark:border-white/10 dark:bg-white dark:text-black",onClick:()=>{C(!1),window.location.href="/"},children:"Go to homepage now"})]})]})]})}},7930:(e,t,a)=>{Promise.resolve().then(a.bind(a,7352))}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=7930)),_N_E=e.O()}]);